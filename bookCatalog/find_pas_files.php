<?php
/**
 * Скрипт для поиска всех файлов с расширением .pas в директории app и её поддиректориях,
 * исключая папки, начинающиеся с точки (.) или двойного подчеркивания (__),
 * и записи их полных путей в файл 111.txt.
 */

// Укажите путь к директории, в которой нужно искать файлы
$directory = __DIR__ . '/app';

// Укажите путь к файлу, в который будут записаны результаты
$outputFile = __DIR__ . '/111.txt';

// Проверяем, существует ли директория
if (!is_dir($directory)) {
    die("Директория '$directory' не существует.");
}

// Открываем файл для записи. Если файл существует, он будет перезаписан.
// Если не удается открыть файл, скрипт завершится с ошибкой.
$handle = fopen($outputFile, 'w');
if (!$handle) {
    die("Не удалось открыть файл '$outputFile' для записи.");
}

// Функция для рекурсивного поиска файлов с исключением определенных папок
function findPasFiles($dir, $handle) {
    // Открываем директорию
    if ($handleDir = opendir($dir)) {
        while (($file = readdir($handleDir)) !== false) {
            // Пропускаем текущую и родительскую директории
            if ($file === '.' || $file === '..') {
                continue;
            }

            // Полный путь к текущему элементу
            $path = $dir . DIRECTORY_SEPARATOR . $file;

            if (is_dir($path)) {
                // Получаем базовое имя директории
                $baseName = basename($path);

                // Проверяем, начинается ли имя директории с точки или двойного подчеркивания
                if (strpos($baseName, '.') === 0 || strpos($baseName, '__') === 0) {
                    // Пропускаем эту директорию
                    continue;
                }

                // Рекурсивный вызов для поддиректорий
                findPasFiles($path, $handle);
            } elseif (is_file($path) && pathinfo($path, PATHINFO_EXTENSION) === 'pas') {
                // Записываем полный путь к файлу в файл
                fwrite($handle, $path . PHP_EOL);
            }
        }
        closedir($handleDir);
    } else {
        // Если не удается открыть директорию, выводим предупреждение
        echo "Не удалось открыть директорию: $dir" . PHP_EOL;
    }
}

// Запускаем функцию для поиска файлов
findPasFiles($directory, $handle);

// Закрываем файл
fclose($handle);

echo "Список файлов записан в '$outputFile'.";
?>