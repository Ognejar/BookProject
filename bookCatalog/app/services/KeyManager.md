# Руководство по модулю KeyManager

## Обзор

Модуль `KeyManager` предназначен для генерации, хранения и валидации целочисленных ключей в оперативной памяти. Он поддерживает создание автоинкрементных идентификаторов для различных сущностей базы данных, что позволяет эффективно управлять уникальными ключами в приложениях.

## Основные функции

### Конструктор и деструктор

- **`constructor Create;`**: Инициализирует объект `TKeyManager` и создаёт хранилище ключей в виде словаря `TDictionary<string, Integer>`.
- **`destructor Destroy; override;`**: Освобождает ресурсы, занятые хранилищем ключей.

### Основные методы

- **`function GetNextKey(const Name: string): Integer;`**: Возвращает следующий уникальный ключ для заданного имени. Если имя не существует в хранилище, оно добавляется с начальным значением 1. Если имя уже существует, ключ увеличивается на 1.

- **`function GetCurrentKey(const Name: string): Integer;`**: Возвращает текущий ключ для заданного имени без увеличения счётчика. Если имя не найдено, выбрасывается исключение `EKeyNotFoundException`.

- **`function KeyExists(const Name: string; const Key: Integer): Boolean;`**: Проверяет, существует ли ключ для указанного имени. Возвращает `True`, если имя существует и его значение больше или равно заданному ключу.

- **`procedure ResetKeys(const Name: string);`**: Сбрасывает счётчик ключей для указанного имени, устанавливая его значение в 0.

## Пример использования

```pascal
var
  KeyManager: TKeyManager;
  NextKey, CurrentKey: Integer;
begin
  KeyManager := TKeyManager.Create;
  try
    // Получение следующего ключа для имени 'Entity'
    NextKey := KeyManager.GetNextKey('Entity');
    // Получение текущего ключа для имени 'Entity'
    CurrentKey := KeyManager.GetCurrentKey('Entity');
    // Проверка существования ключа
    if KeyManager.KeyExists('Entity', 1) then
      WriteLn('Ключ существует.');
    // Сброс ключей для имени 'Entity'
    KeyManager.ResetKeys('Entity');
  finally
    KeyManager.Free;
  end;
end;
```

## История изменений

- **2025-01-31**: Создан модуль с базовыми функциями управления ключами (GUID).
- **2025-02-05**: Добавлена проверка на пустой ключ, улучшена валидация GUID. Добавлена функция удаления ключей из хранилища.
- **2025-02-06**: Переход на целочисленные ключи для оптимизации работы с базой данных в памяти. Добавлена поддержка именованных пространств ключей через `GetNextKey`. Добавлена функция получения текущего ключа через `GetCurrentKey`.

## Заключение

Модуль `KeyManager` обеспечивает удобный и эффективный способ управления уникальными ключами в приложениях, особенно полезен в сценариях, где требуется автоинкрементные идентификаторы для различных сущностей базы данных.